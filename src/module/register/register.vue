<template>
<div>
  <div v-if="modal" class="modal-mask">
      <div class="modal-wrapper">
        <div class="modal-container">
          <div class="modal-header">
            柯咔服装网用户协议
          </div>
          <div class="modal-body">
            <p>欢迎您与广州柯咔网络科技有限公司（以下简称“柯咔”）就柯咔服装网（域名：柯咔buy.com）服务等相关事宜共同签署《柯咔服装网用户协议》（以下简称“本协议”）。</p>

            <p>您在申请注册流程中点击同意本协议之前，应当认真阅读本协议。当您按照注册页面提示填写信息、阅读并同意本协议且完成全部注册程序后，即表示您已充分阅读、理解并接受本协议的全部内容，并与柯咔达成一致，成为柯咔服装网用户。阅读本协议的过程中，如果您不同意本协议或其中任何条款约定，您应立即停止注册程序。</p>

            <div class="part">
              <h3>一、接受条款</h3>
              <h4>1.本协议内容包括协议正文及所有柯咔服装网已经发布或将来可能发布的各类规则。所有规则为协议不可分割的一部分，与协议正文具有同等法律效力。</h4>
              <h4>2.柯咔服装网的各项电子服务的所有权和运作权归柯咔所有。用户同意所有注册协议条款并完成注册及认证程序，才能成为柯咔服装网的正式用户。</h4>
              <h4>3.柯咔保留在中华人民共和国大陆地区法施行之法律允许的范围内独自决定拒绝服务、关闭用户账户、清除或编辑内容或取消订单的权利。</h4>
              <h4>4.用户点击同意本协议，即视为用户确认自己具有享受平台服务的权利能力和行为能力，能够独立承担法律责任。</h4>
              <h4>5.柯咔有权根据需要制订、修改本协议及/或各类规则，并以网站公示的方式进行公告，不再单独通知您。变更后的协议和规则一经在柯咔服装网公布后，立即自动生效。如您不同意相关变更，应当立即停止使用柯咔服装网平台服务。您继续使用柯咔服装网服务的，即表示您接受经修订的协议和规则。</h4>
              <h4>6.本协议不涉及用户与柯咔其它用户之间因网上交易而产生的法律关系及法律纠纷。</h4>
            </div>

            <div class="part">
              <h3>二、账号注册及使用</h3>
              <h4>1.账户注册</h4>
              <p>1.1 在您按照注册页面提示填写信息、阅读并同意本协议且完成全部注册程序后，或在您按照激活页面提示填写信息、阅读并同意本协议且完成全部激活程序后，或您以其他柯咔允许的方式实际使用柯咔服务时，您即受本协议的约束。</p>
              <p>1.2 您了解并同意，如您系在本网站完成的注册程序，只要您注册成功，您即可以获得您的柯咔登录名。您在此明确授权，您的账户信息在您注册成功时，已授权柯咔服装网披露并使用，以使您更便捷地使用柯咔服务。</p>
              <h4>2.账户使用</h4> 
              <p>2.1 您可以使用您提供或确认的邮箱、手机号码或者柯咔允许的其它方式作为登录手段进入柯咔网站。</p> 
              <p>2.2 由于您的柯咔账户关联您的个人信息及柯咔服装网商业信息，您的柯咔账户仅限您本人使用。未经柯咔平台同意，您直接或间接授权第三方使用您的柯咔账户或获取您账户项下信息的行为无效。如柯咔服装网判断您柯咔账户的使用可能危及您的账户安全及/或柯咔服装网信息安全的，柯咔服装网可拒绝提供相应服务或终止本协议。</p> 
              <h4>3.信息真实</h4> 
              <p>在完成注册及认证流程时，您应当按照法律法规要求，正确提供注册所需的资料和资质文件，以使之真实、及时，完整和准确。如有合理理由怀疑您提供的资料错误、不实、过时或不完整的，柯咔有权向您发出询问及/或要求改正的通知，并有权直接做出删除相应资料的处理，直至中止、终止对您提供部分或全部平台服务，柯咔对此不承担任何责任，您将承担因此产生的任何直接或间接损失及不利后果。</p>
              <h4>4.账户安全</h4>  
              <p>您须自行负责对您的柯咔登录名、昵称和密码保密，且须对该登录名、昵称和密码下发生的所有活动（包括但不限于信息披露、发布信息、网上点击同意或提交各类规则协议、网上续签协议或购买服务等）承担责任。您同意：</p> 
              <p>4.1 如发现任何人未经授权使用您的柯咔登录名、昵称和密码，或发生违反保密规定的任何其他情况，您会立即通知柯咔，并授权柯咔将该信息同步给柯咔网站；</p> 
              <p>4.2 确保您在每个上网时段结束时，以正确步骤离开网站。柯咔不能也不会对因您未能遵守本款规定而发生的任何损失或损毁负责。您理解柯咔对您的请求采取行动需要合理时间，柯咔对在采取行动前已经产生的后果（包括但不限于您的任何损失）不承担任何责任。除非有法律规定或司法裁定，且征得柯咔的同意，否则，您的柯咔登录名、昵称和密码不得以任何方式转让、赠与或继承（与账户相关的财产权益除外）。</p>
            </div>
          </div>

          <div class="modal-footer">
            <button v-on:click="modal = false">确 定</button>
          </div>
        </div>
      </div>
    </div>

  <div class="register-t">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="register-t-tit">
            <a href="./index.html">
              <img src="../../assets/images/logo.svg" width="150">
            </a>
            <span>欢迎注册</span>
          </div>          
        </div>
      </div>
    </div>   
  </div>
  
  <div class="register-m">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="register">
            <div class="register-head">
              <div class="register-head-tit">
                新用户注册
              </div>
              <div class="register-head-menu">
                <span>已有账号?</span>
                <span><a href="./login.html">立即登录</a></span>
              </div>
            </div>
            <form v-on:submit="_submit">
              <div class="form-phone">
                <label>手<span class="em"></span><span class="em"></span>机</label>
                <div class="input-box">
                  <span class="icon-zhanghao"></span>
                  <input type="text" name="mobile" placeholder="请输入手机号码" ref="phone" v-on:blur="_checkPhone($event)" v-on:focus="_writePhone">
                </div>                        
              </div>
              <div class="form-psd">
                <label>密<span class="em"></span><span class="em"></span>码</label>
                <div class="input-box">
                  <span class="icon-mima"></span>
                  <input type="password" name="password" placeholder="请输入密码" ref="password">
                </div>
              </div>
              <div class="form-psd-cfig">
                <label>确认密码</label>
                <div class="input-box">
                  <span class="icon-mima"></span>
                  <input type="password" name="password_confirmation" placeholder="请确认密码" ref="confirmPassword">
                </div>
              </div>
              <div class="form-verify">
                <label>短信验证</label>
                <div class="input-box">
                  <input type="text" name="code" placeholder="请输入验证码">
                  <button type="button" v-bind:class="sendMsg ? 'after' : 'before'" v-bind:disabled="sendMsg" v-on:click="getCode">{{btnContent}}</button>
                </div>            
              </div>
              <div class="form-xieyi">
                <input type="checkbox" v-model="agree">
                <label>我已阅读并同意<a v-on:click="modal = true">《柯咔网络用户服务协议》</a></label>
              </div>
              <div class="form-err" v-bind:style="{display: error ? 'block' : 'none'}">
                {{error}}
              </div>
              <div class="form-submit">
                <button v-bind:disabled="!agree" v-bind:class="!agree ? 'disabled' : ''">注<span class="em"></span><span class="em"></span>册</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  

  <div class="register-b">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="register-b-tit">
            Copyright©2017 广州柯咔网络科技有限公司  www.cookabuy.com  粤ICP备15091531号  客服热线:400-8868-900
          </div>          
        </div>
      </div>
    </div>   
  </div>  
</div>
</template>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<script>
  import Vue from 'vue'
  const VueResource = require('vue-resource')
  Vue.use(VueResource)
  const fto = require('form_to_object')
  Vue.use(fto)
  export default{
    data () {
      return {
        modal: false,
        error: '',
        btnContent: '获取短信验证码',
        sendMsg: false,
        sendTime: 60,
        agree: true
      }
    },
    methods: {
      _checkPhone (e) {
        if((!e.target.value) || (e.target.value && !(/^1[\d]{10}$/.test(this.$refs.phone.value)))){
          this.error = '请输入正确的手机号码'
        }
        else{
          this.$http.get('/jwt/check_exist?mobile=' + e.target.value)
            .then(
              function(ret){
                if(!ret.data.msg){
                  this.error = '';
                }
                else{
                  this.error = '该账号已注册';
                }
              },
              function(err){
                console.log(err)
            })
        }
        
      },
      _writePhone () {
        this.error = ''
      },
      getCode () {
        var me = this;
        if(!(/^1[\d]{10}$/.test(me.$refs.phone.value))){
          this.error = '请输入正确的手机号码'
        }
        else{
          this.$http.get('/jwt/send_code?mobile='+this.$refs.phone.value+'&type=sign_up')
          .then(function (ret) {
            if(ret.data.msg == 'OK'){
              me.sendMsg = true;
              me.btnContent = '获取验证码(' + me.sendTime + ')'
              var timer = setInterval(function(){          
                me.sendTime--
                me.btnContent = '获取验证码(' + me.sendTime + ')'
                if(me.sendTime == 0){
                  clearInterval(timer)
                  me.sendTime = 60
                  me.sendMsg = false
                  me.btnContent = '获取短信验证码'
                }
              },1000)
            }
          },
          function (err) {
            console.log(err)
          })
        }
        
      },
      _submit (e) {
        e.preventDefault();
        var data = fto(e.target)
        if (!data.mobile) {
          this.error = '手机号码不能为空'
          return false;
        }
        else{
          this.error = '';
        }
        if(!(/^1[\d]{10}$/.test(data.mobile))){
          this.error = '请输入正确的手机号码'
          return false;
        }
        else{
          this.error = ''
        }
        if(!data.password){          
          this.error = '密码不能为空'
          return false;
        }
        else if (data.password !== data.password_confirmation) {
          this.error = '两次密码输入不一致'
          return false;
        }
        else{
         this.error = ''
        }
        if (!data.code){          
          this.error = '验证码不能为空'
          return false;
        }
        else if (!(/^[\d]{6}$/.test(data.code))){
          this.error = '验证码格式不正确'
          return false;
        }
        else{
          this.error = ''
        }
        this.$http.post('/jwt/sign_up',{'user': data})
          .then(function (ret) {
            if(ret.data.msg == 'OK'){
              this.error = ''
              location.href = './login.html'
            }
            else if(ret.data.errors == 'Sms code is error.'){
              this.error = '验证码错误'
            } 
          },
          function (err) {
            console.log(err)
          })
      }
    },
    mounted () {
      
    }
  }
</script>
<style lang="less">
  @import '../../assets/css/icons.css';
  @import '../../assets/css/bootstrap.css';
  @import "../../assets/less/register.less";
</style>